= Quarkus Cucumber
include::./includes/attributes.adoc[]

:extension-status: experimental

This extension allows you to use https://cucumber.io/[Cucumber] to test your Quarkus application.

== Installation

If you want to use this extension, you need to add the `io.quarkiverse.cucumber:quarkus-cucumber` extension first.
In your `pom.xml` file, add:

[source,xml,subs=attributes+]
----
<dependency>
    <groupId>io.quarkiverse.cucumber</groupId>
    <artifactId>quarkus-cucumber</artifactId>
    <version>{quarkus-cucumber-version}</version>
</dependency>
----

== Usage

=== Quarkus Test setup

To bootstrap Cucumber add the following class to your test suite:

[source,java]
----
import io.quarkiverse.cucumber.CucumberQuarkusTest;

public class MyTest extends CucumberQuarkusTest {
}
----

This will automatically bootstrap Cucumber, and discover any `.feature` files and step classes that provide glue code.

=== Integration test setup

For integration tests to work, we leverage the `QuarkusComponentTest`-feature. For this to work, we have to make the step-class to beans (by adding a bean-defining annotation, e.g. `@ApplicationScoped`, `@Singleton`, ...), and add `@Unremovable` to all bean-defining classes.

If we use constructor injection, then bean-defining classes must provide a no-args constructor, or be in a scope that does not generate proxy-objects, e.g. `@Singleton`.

In the following is an example that shows the different ways of registering beans; with `@NormalScoped` beans, as well as with `@Singleton`.
[source,java]
.`MySteps.java`
----
@Unremovable
@Singleton
public class MySteps {
    private final MyActor myActor;

    @Inject
    public MyStep(MyActor myActor) {
        this.myActor = myActor;
    }
}
----
[source,java]
.`MyActor.java`
----
@Unremovable
@ApplicationScoped
public class MyActor {
    private final String someProperty;

    /**
     * Constructor for CDI to create proxy objects.
     */
    @SuppressWarnings("unused")
    public CucumberResourceActor() {
        this(null);
    }


    @Inject
    @SuppressWarnings("unused")
    public CucumberResourceActor(@ConfigProperty(name = "some-property") String someProperty) {
        this.someProperty = someProperty;
    }
}
----

Furthermore, we have to register all bean-defining classes a step explicitly with the `QuarkusComponentTestExtension`:
[source,java]
.`MyIT.java`
----
import io.quarkiverse.cucumber.CucumberQuarkusIntegrationTest;

public class MyIT extends CucumberQuarkusIntegrationTest {
    @RegisterExtension
    static final QuarkusComponentTestExtension COMPONENT_TEST_EXTENSION = new QuarkusComponentTestExtension(
            MySteps.class, MyActor.class);
}
----


== IDE Integration

The test class can by run by any IDE with support for JUnit5.

In IntelliJ it is possible to directly run feature files:

image::run-cucumber-inside-intellij.gif[]

You need to add the following `main` method to your test class:

[source,java]
----
import io.quarkiverse.cucumber.CucumberQuarkusTest;

public class MyTest extends CucumberQuarkusTest {
    public static void main(String... args) {
        runMain(MyTest.class, args);
    }
}
----

////
Uncomment if we end up having configuration properties for this extension
== Configuration Reference

include::includes/quarkus-cucumber.adoc[]
////
